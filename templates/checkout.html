{% extends "base.html" %}

{% load static %}
{% load unit_price %}
{% load total_price %}

{% block per_page_css %}
    <link rel="stylesheet" href="{% static 'css/checkout.css' %}">
{% endblock per_page_css %}

{% block jquery %}
    <script>
        const clientToken = "{{ client_token }}";

        braintree.setup(clientToken, "dropin", {
            container: "payment-form"
        });
    </script>
{% endblock jquery %}

{% block main_content %}

    {% if messages %}
        <div class='messages'>
            <ul class="messages">
                {% for message in messages %}
                    <li {% if message.tags %} class="{{message.tags}}" {% endif %}> {{ message }} </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <!-- send user instance as object, populate the page with it -->
    <div class="container-fluid main_content">
        <div class="row banner">
            <div class="col-md-12">
                <h3> Order Summary </h3>
            </div>
        </div>
    </div>

    <div class="container confirm">
        <div class="row">
            <table class="table table-light table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Item</th>
                        <th>Per Book Price</th>
                        <th>Quantity</th>
                        <th>Amount</th>
                    </tr>
                </thead>

                <tbody>
                    {% for item in cart %}
                        <tr>
                            <th scope="row">{{ item.book.name }}</th>
                            <th>${{ item.price }}</th>
                            <th>{{ item.count }}</th>
                            <th id="amount 1">${% unit_price item.price item.count %}</th>
                        </tr>
                    {% endfor %}
                <tbody>
            </table>
        </div>
        <div class="row">
			<div class="offset-md-3 col-md-6">
					<form id="checkout" method="post" action="submit/"> {% csrf_token %}
					<ul class="list-group">
						<li class="list-group-item">
							<h3>Shipping Address:</h3>
							<input type="text" name="new_address" placeholder="New Address">
							Save: <input type="checkbox" name="save_address"> <br>

							<fieldset class="spaced">
								<legend>Saved Addresses:</legend>
								{% for address in request.user.member.saved_addresses.all %}
									<ul class="list-group">
										<li class="list-group-item list-group-item-info">
											<input type="radio" name="{{ address.location }}">{{ address.location }}<br>
										</li>
									</ul>
								{% endfor %}
							</fieldset>
						</li>
						<li class="list-group-item">
							<div id="payment-form"></div>
						</li>
						<li class="list-group-item center">
							<div class="checkout_cont">
								<input id="checkout_btn" class="btn btn-sm btn-dark" type="submit" value="Submit Order">
							</div>
						</li>
					</ul>
				</form>
			</div>
        </div>
    <br>
    
		<div class="row">
			<div class="offset-md-3 col-md-6 center">
				<a href="{% url 'cart:cart' %}"><button id="edit" class="btn-sm btn-dark">Return to Cart</button></a>
			</div>
		</div>
    </div>

{% endblock main_content %}